# LostETHFound - ZK On-Chain Lost & Found (Hackathon 1-2 Days)

Audience: Claude Code (builder agent). Goal: a mostly on-chain, trust-minimized MVP using ZK proofs. Keep scope tight, demo-ready.

Execution checklist: `LOSTETHFOUND_CHECKLIST.md`
Protocol spec: `SPEC.md`

---

## 0) Scope and Assumptions
- The MVP ships **two systems** in one product:
  - **Trustless lane** (auto-claim) for items with a **high-entropy secret** (QR/tag/long random phrase, or strong serial + secret sticker).
  - **Assisted lane** (owner-verify) for items without a secret, using Q/A + encrypted chat. For MVP, this is event-based (no extra ZK circuit).
- Low-entropy attributes (color, brand, day) are **not** a security gate; they are only hints in the assisted lane.
- Credit cards are supported **only via a wallet/sleeve tag secret** or a local-only secret. If any card info is used, it must stay **entirely local** and **never be transmitted or stored**, with only a derived commitment used on-chain.
- MVP focuses on macbooks, phones, and credit cards (plus any tagged items).

---

## 1) Tech Stack (fast to ship)
- ZK: **Circom + snarkjs (Groth16)** for quick EVM verifier generation.
- On-chain: **Hardhat** for Solidity contracts.
- Frontend: **Next.js + viem/wagmi**.
- Crypto: **Poseidon hash** (circomlib) for commitments and nullifiers.
- Registry: a **minimal mapping-based registry contract** that stores commitments and rewards.

Rationale: Circom + snarkjs has the fastest path to a Solidity verifier and plenty of examples.

---

## 2) Core Idea (two lanes)
**Trustless lane:** Owner registers a commitment to a secret, and a finder proves knowledge of that secret without revealing it.

- Owner secret: random 128-bit string (QR/tag), stored only with the item.
- Commitment: `C = Poseidon(secret || categoryId || itemIdSalt)`
- Claim proof: ZK proof of knowledge of `secret` and computation of `C`.
- Contract verifies the proof AND that `C` exists in registry.
- Nullifier prevents double-claim: `N = Poseidon(secret || claimId)`.

This keeps everything on-chain while not revealing the secret.

**Assisted lane:** Owner registers a commitment to answers (salted). Finder submits answers via encrypted chat. Owner approves and releases reward (optional ZK proof that answers match, if time permits).
For MVP, assisted lane uses **on-chain events only**:
- `reportLost` emits `LostReported` with encrypted hints/contact.
- `reportFound` emits `FoundReported` with encrypted message.
- UI searches logs via `getLogs` (no indexer required).

---

## 3) On-Chain Contracts (MVP)

### 3.1 Registry (Minimal)
Functions:
- `registerItem(bytes32 commitment, bytes encryptedContact, uint256 rewardWei)`
  - Stores commitment => item metadata
  - Escrows reward
- `isRegistered(bytes32 commitment) -> bool`
- `claim(bytes proof, bytes32 commitment, bytes32 nullifier, address payout)`
  - Verifies proof
  - Checks commitment exists
  - Checks nullifier unused
  - Marks nullifier used
  - Pays reward
Event-only assisted lane:
- `reportLost(bytes32 categoryId, bytes encryptedContact, bytes hints)` → emits `LostReported`
- `reportFound(bytes32 categoryId, bytes encryptedMessage)` → emits `FoundReported`

Storage:
- `mapping(bytes32 => Item)`
- `mapping(bytes32 => bool) nullifierUsed`

Item fields:
- owner
- encryptedContact (optional)
- reward
- status

### 3.2 Verifier
- Groth16 verifier generated by snarkjs for the circuit.

---

## 4) ZK Circuit (Circom)

Public inputs:
- `commitment` (bytes32)
- `nullifier` (bytes32)

Private inputs:
- `secret` (field)
- `categoryId` (field)
- `itemIdSalt` (field)
- `claimId` (field)

Constraints:
- `commitment == Poseidon(secret, categoryId, itemIdSalt)`
- `nullifier == Poseidon(secret, claimId)`

Notes:
- Keep it simple: no Merkle tree in MVP.
- Commitment revealed as public input; it does NOT reveal the secret.

---

## 5) Frontend Flow

### Owner Flow
1. **Add a Return Tag (pre-loss):**
   - Choose item type → generate return tag code → post commitment + bounty.
2. **Report Lost:**
   - If the item has a return tag: enter the code → check registry status (registered/claimed).
   - If no return tag: post lost report (encrypted hints/contact) via `reportLost`.

### Finder Flow
**Trustless:** scan/enter secret from the item → generate ZK proof → submit claim tx.

**Assisted (no tag):** submit `reportFound` with encrypted message; optionally search `LostReported` logs by item type.

### Contact
- Owner contact info is encrypted with a public key and stored on-chain.
- Finder can send a message using the same encryption scheme.

---

## 6) Category Strategy (realistic)
- MacBook: hidden tag secret in sleeve or on device; serial + secret if needed.
- Phone: hidden tag secret; serial/IMEI + secret if needed.
- Credit card: wallet/sleeve tag secret; if any card info is used, keep it **local-only**.
- Other items: add QR tag or engraved secret.

---

## 7) Day-by-Day Build Plan

### Day 1 (Core ZK + contracts)
1. Scaffold repo: /contracts, /circuits, /web.
2. Build circom circuit and generate Groth16 keys + verifier.
3. Implement registry + claim contract.
4. Write simple tests: register -> claim -> reward.

### Day 2 (UI + demo polish)
1. Next.js UI for register and claim.
2. Integrate snarkjs proof generation in frontend.
3. Add encrypted contact storage + display.
4. Demo script and walkthrough.
5. Add event-based lost/found reports + log search in UI.

---

## 8) Security / Abuse Mitigations
- Require a small bond for claim txs to deter spam.
- Use nullifier to prevent repeat claims.
- Do not accept low-entropy secrets.

---

## 9) Stretch Goals (if time)
- Replace mapping with Merkle tree + membership proof.
- Add owner-mediated Q/A proof (not fully trustless).
- Add a lightweight off-chain indexer for better UX.
 - Optional: ZK “question pack” circuit (threshold match). Not needed for MVP.

---

## 10) Prize Alignment Notes
Prizes list only totals and tracks right now; sponsor-specific prizes are listed as “coming soon”. Plan a strong demo and be ready to adapt once sponsor details are published on the prize page.

Prize page: https://ethchiangmai.devfolio.co/prizes

---

## 11) Demo Script (2-3 minutes)
1. Owner registers item, shows QR secret.
2. Finder scans secret, generates proof.
3. Claim tx verifies proof and releases reward.
4. Explain privacy: secret never revealed, only proof.

---

## 12) What to Avoid
- Credit card data or personal identifiers.
- Low-entropy Q/A verification.
- Overly complex ZK circuits in MVP.
